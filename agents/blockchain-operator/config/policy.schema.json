{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://openclaw.local/blockchain-operator/policy.schema.json",
  "title": "Blockchain Operator Policy",
  "type": "object",
  "required": [
    "version",
    "execution",
    "allowlists",
    "limits",
    "marketData",
    "routing",
    "reporting",
    "circuitBreaker",
    "idempotency"
  ],
  "properties": {
    "version": { "type": "integer", "minimum": 1 },
    "execution": {
      "type": "object",
      "required": [
        "mode",
        "defaultDryRun",
        "allowMainnetOnly",
        "requireSimulation",
        "humanConfirmation",
        "requireRecipientAllowlist",
        "requireKeySegregation"
      ],
      "properties": {
        "mode": { "type": "string", "enum": ["autonomous"] },
        "defaultDryRun": { "type": "boolean" },
        "allowMainnetOnly": { "type": "boolean" },
        "requireSimulation": { "type": "boolean" },
        "humanConfirmation": { "type": "boolean" },
        "requireRecipientAllowlist": { "type": "boolean" },
        "requireKeySegregation": { "type": "boolean" }
      },
      "additionalProperties": false
    },
    "allowlists": {
      "type": "object",
      "required": [
        "chains",
        "assets",
        "recipients",
        "contracts",
        "bridgeRoutes",
        "hyperliquidSymbols"
      ],
      "properties": {
        "chains": {
          "type": "array",
          "items": { "type": "string", "enum": ["base", "solana", "hyperliquid"] }
        },
        "assets": { "type": "array", "items": { "type": "string" } },
        "recipients": { "type": "array", "items": { "type": "string" } },
        "contracts": { "type": "array", "items": { "type": "string" } },
        "bridgeRoutes": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["from", "to"],
            "properties": {
              "from": { "type": "string" },
              "to": { "type": "string" }
            },
            "additionalProperties": false
          }
        },
        "hyperliquidSymbols": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },
    "limits": {
      "type": "object",
      "required": [
        "maxNotionalUsdPerTx",
        "maxNotionalUsdPerDay",
        "maxSlippageBps",
        "maxGasUsdPerTx",
        "maxPerpLeverage",
        "maxOrderSize",
        "defaultSlippageBps"
      ],
      "properties": {
        "maxNotionalUsdPerTx": { "type": ["number", "null"], "minimum": 0 },
        "maxNotionalUsdPerDay": { "type": ["number", "null"], "minimum": 0 },
        "maxSlippageBps": { "type": ["number", "null"], "minimum": 0 },
        "maxGasUsdPerTx": { "type": ["number", "null"], "minimum": 0 },
        "maxPerpLeverage": { "type": ["number", "null"], "minimum": 1 },
        "maxOrderSize": { "type": ["number", "null"], "minimum": 0 },
        "defaultSlippageBps": { "type": ["number", "null"], "minimum": 0 }
      },
      "additionalProperties": false
    },
    "marketData": {
      "type": "object",
      "required": ["primaryPriceSource", "fallbackPriceSource"],
      "properties": {
        "primaryPriceSource": { "type": "string", "enum": ["chainlink", "pyth"] },
        "fallbackPriceSource": { "type": "string", "enum": ["chainlink", "pyth"] }
      },
      "additionalProperties": false
    },
    "routing": {
      "type": "object",
      "required": ["bridgeProviders", "bridgeSourceChains", "hyperliquidOperationalRole"],
      "properties": {
        "bridgeProviders": {
          "type": "array",
          "items": { "type": "string", "enum": ["debridge"] },
          "minItems": 1
        },
        "bridgeSourceChains": {
          "type": "array",
          "items": { "type": "string", "enum": ["base", "solana"] },
          "minItems": 1
        },
        "hyperliquidOperationalRole": {
          "type": "string",
          "enum": ["destination_l3"]
        }
      },
      "additionalProperties": false
    },
    "reporting": {
      "type": "object",
      "required": ["discordChannelId", "perOperation", "dailySummary"],
      "properties": {
        "discordChannelId": { "type": "string", "pattern": "^[0-9]{6,30}$" },
        "perOperation": { "type": "boolean" },
        "dailySummary": {
          "type": "object",
          "required": ["enabled", "timeUtc"],
          "properties": {
            "enabled": { "type": "boolean" },
            "timeUtc": { "type": "string", "pattern": "^([01][0-9]|2[0-3]):[0-5][0-9]$" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "circuitBreaker": {
      "type": "object",
      "required": ["enabled", "maxFailures", "windowSec", "cooldownSec"],
      "properties": {
        "enabled": { "type": "boolean" },
        "maxFailures": { "type": "integer", "minimum": 1 },
        "windowSec": { "type": "integer", "minimum": 1 },
        "cooldownSec": { "type": "integer", "minimum": 1 }
      },
      "additionalProperties": false
    },
    "idempotency": {
      "type": "object",
      "required": ["ttlDays"],
      "properties": {
        "ttlDays": { "type": "integer", "minimum": 1 }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
