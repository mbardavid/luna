# 2026-02-24 — Daily Memory Log

## Operacional

- **OpenClaw atualizado** de `2026.2.21-2` → `2026.2.22-2` via `sudo npm update -g openclaw`. Instalação ativa é em `/usr/lib` (root), não `~/.local/lib` (user). Lembrar de usar `sudo` para updates globais.
- **Gateway restart notify hook** criado: `scripts/gateway-restart-notify.sh` + systemd drop-in `ExecStartPost`. Toda vez que o gateway reinicia, mensagem automática vai pro `#general-luna`.
- **Reasoning leak fix:** O modelo `claude-opus-4-6-thinking` produz thinking blocks que o gateway na versão 2026.2.22-2 vaza pro Discord. O problema persiste — não é controlável do lado do agente. Matheus está ciente.

## Mission Control

- **Plano Unificado v2** finalizado em `docs/mission-control-unified-plan.md` — merge do plano original + plano externo + review GPT.
- **Princípios chave V1:** Luna é único escritor no MC; taskId⇄sessionKey first-class; recovery via `sessions_list`; degrade mode (não auto-kill); approval tiers por tipo (não por valor).
- **Fixes aplicados:** Watchdog anti-re-spam (checa `mc_last_error == "stalled"`); delivery busca último comment real; kill default desativado (`MC_RESOURCE_MONITOR_KILL=0`); `.gitignore` atualizado.
- **Runbook Fase 1** criado em `docs/mission-control-phase1-runbook.md` com 8 cenários de teste.
- **41 tasks de QA deletadas** — board limpo com 8 tasks legítimas.
- **Kanban funcional:** Matheus acessou dashboard em `142.93.87.36:3000` e confirmou visualização do Kanban.
- **Primeira task real criada no MC:** "Integrar MC ao fluxo operacional da Luna" — a partir de agora, tasks devem ser criadas automaticamente conforme trabalho acontece.

## Agentes

- **Modelo do Luan corrigido:** Era `openai-codex/gpt-5.3-codex-xhigh-spark` (falhava com `Unknown model` + `thinking.signature` error no failover). Trocado para `google-antigravity/claude-opus-4-6-thinking`.
- **pg-gpt recebeu spawn permissions:** `subagents.allowAgents` adicionado via `openclaw.json` — pode spawnar luan, crypto-sage, quant-strategist, playground, main.
- **pg-gpt timeout investigado:** Spawnou Luan com sucesso, produziu plano detalhado (5 bugs + 4 fases), mas deu timeout de 10min tentando implementar edits que conflitavam com as da Luna. Plano recuperado dos logs e salvo em `docs/a2a-mission-control-phase1to2-plan.md`.

## Feedback do Matheus (importante)

- **"Preciso de feedback quando coisas acontecem"** — Antes de ações que causam desconexão (gateway restart), SEMPRE avisar antes.
- **"Não sou eu que deveria popular o MC"** — Tasks no Kanban devem ser criadas automaticamente pela Luna conforme trabalho acontece, sem intervenção humana.
- **"Quero ver agentes real-time no Kanban"** — O MC já tem Kanban nativo com 4 colunas + SSE streams. Precisa ser alimentado automaticamente.

## Lições

- Nunca reiniciar gateway sem avisar Matheus primeiro.
- `sudo` é necessário para `npm update -g` quando instalação está em `/usr/lib`.
- Modelo do agente deve ser testado com spawn simples antes de usar em produção.
- pg-gpt (OpenAI Codex) não consegue usar `sessions.spawn` via gateway RPC — só funciona via tool nativa do OpenClaw.
- Edits concorrentes entre agentes causam conflito — coordenação é necessária antes de múltiplos agentes editarem mesmos arquivos.

## Resumo das últimas 24h

- **OpenClaw update:** Versão `2026.2.21-2` → `2026.2.22-2`; confirmado que updates globais requerem `sudo`.
- **Gateway restart hook:** Criado script + drop-in systemd para notificar `#general-luna` automaticamente em cada restart.
- **Reasoning leak:** Thinking blocks do `claude-opus-4-6-thinking` vazam pro Discord na v2026.2.22-2; problema upstream, sem fix disponível do lado do agente.
- **Mission Control Fase 1 concluída:** Plano Unificado v2 finalizado, Kanban funcional em `142.93.87.36:3000`, 41 tasks de QA limpas, 8 legítimas restantes. Primeira task real criada. Runbook de 8 cenários pronto.
- **Modelo do Luan corrigido:** De `openai-codex/gpt-5.3-codex-xhigh-spark` (broken) → `claude-opus-4-6-thinking` (funcional).
- **pg-gpt spawn permissions ativadas;** timeout de 10min em tarefa real evidenciou conflito de edits concorrentes entre agentes.
- **Feedback direto do Matheus:** (1) Avisar SEMPRE antes de ações disruptivas; (2) MC deve ser populado automaticamente pela Luna; (3) Agentes devem aparecer em tempo real no Kanban.
- **Decisões pendentes:** Automação de criação de tasks no MC; resolução do reasoning leak; coordenação de edits multi-agent.
- **Riscos:** Reasoning leak afeta UX do Discord; edits concorrentes podem quebrar código se múltiplos agentes trabalharem no mesmo arquivo sem lock.

## Itens para organizar em Skills/Tools/Workflows

1. **Workflows/Rotinas** — Fluxo de notificação pré-gateway-restart (avisar Matheus → aguardar → restart). Rationale: Feedback explícito do Matheus; deve virar rotina obrigatória. Destino: `docs/runbooks/gateway-restart-protocol.md`.
2. **Workflows/Rotinas** — Automação de criação de tasks no MC conforme trabalho acontece. Rationale: Matheus quer MC alimentado automaticamente sem intervenção humana. Destino: `docs/mission-control-auto-task-flow.md`.
3. **Tools** — Registro do hook de restart notify (`scripts/gateway-restart-notify.sh` + drop-in). Rationale: Nova ferramenta operacional que precisa estar documentada em TOOLS.md. Destino: `TOOLS.md` (seção Gateway Hooks).
4. **Docs/Processo** — Runbook de coordenação de edits multi-agent (file locking / turn-based). Rationale: pg-gpt timeout evidenciou que edits concorrentes causam conflito. Destino: `docs/operations/multi-agent-edit-coordination.md`.
5. **Skills** — Procedimento de correção de modelo de agente (teste com spawn simples antes de prod). Rationale: Erro do Luan mostrou que modelos devem ser validados antes de uso. Destino: `docs/agent-standard.md` (seção Model Validation).
6. **Docs/Processo** — Documentar que `sudo` é necessário para updates globais quando instalação está em `/usr/lib`. Rationale: Fato operacional específico do ambiente atual. Destino: `TOOLS.md` (seção OpenClaw Updates).

## Atividade de Sessão

- Sessão interativa principal ativa durante o dia com alta atividade: update OpenClaw, Mission Control fase 1, correção de agentes, feedback do Matheus.
- Cron `daily-memory-24h-log` executado às 19:29 UTC (esta sessão).
